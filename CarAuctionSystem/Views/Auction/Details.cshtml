@model AuctionDetailsModel
@{
	ViewBag.Title = "Auction Details";
	bool hasEnded = Model.EndDate < DateTime.UtcNow;
}

<h2 class="text-center">@ViewBag.Title</h2>

<div class="container" style="display:inline">
	<div class="row">
		<div class="card col border-0">
			<p style="font-size:25px;">
				<span>@Model.ModelYear @Model.Make @Model.Model</span>
			</p>
			<hr/>
			<p>Auction start date: <b>@Model.StartDate</b></p>
			<p>Auction end date: <b>@Model.EndDate</b></p>
			<p>Mileage: <b>@Model.Mileage km</b></p>
			<p>VIN: <b>@Model.Vin</b></p>
			<p>Engine Information: <b>@Model.EngineDetails</b></p>
			<p>Drivetrain: <b>@Model.Drivetrain</b></p>
			<p>Transmisson: <b>@Model.Transmission</b></p>
			<p>Fuel: <b>@Model.Fuel</b></p>
			<p>Car Body Style: <b>@Model.CarBody</b></p>
			<p>Interior color: <b>@Model.InteriorColor</b></p>
			<p>Exterior color: <b>@Model.ExteriorColor</b></p>
			<p></p>
			<div class="card" style="width: 18rem;">
				<div class="card-body">
					<h5 class="card-title">Seller Info</h5>
					<p class="card-text">Username: <a asp-controller="User" asp-action="Profile" asp-route-id="@Model.SellerDetails.Id">@Model.SellerDetails.Username</a></p>
					<p class="card-text">Email: @Model.SellerDetails.Email</p>
					<p class="card-text">Phone Number: @Model.SellerDetails.PhoneNumber</p>
				</div>
			</div>
		</div>
		<div class="card col border-0">
			<p style="font-size:25px;">Bid History:</p>
			<hr/>
			@if (!Model.Bids.Any())
			{
				<p>No bids placed for this auction.</p>
			}
			else
			{
				<p>Bid count: @Model.Bids.Count</p>
				@foreach (var bid in Model.Bids)
				{
					<p>@bid.BidDate <a asp-controller="User" asp-action="Profile" asp-route-id="@bid.BidderId">@bid.BidderUsername</a> - @bid.BidAmount.ToString("C")</p>
				}
				@if (hasEnded)
				{
					<p>Sold to @Model.Bids.Last().BidderUsername for @Model.Bids.Last().BidAmount.ToString("C")</p>
				}
			}
			@if (hasEnded)
			{
				<p><b>Auction has ended. Bids are closed.</b></p>
			}
			else
			{
				@if (User.Id() != Model.SellerDetails.Id)
				{
					<a asp-controller="Bid" asp-action="Bid" asp-route-id="@Model.Id" class="btn btn-success">Place Bid</a>
				}
			}
		</div>
		<div class="col">
			<img class="card-img-top" style="width: 25rem;" src="@Model.ImageUrl" alt="Car Image">
			<p></p>
			@if (Model.Watchlist.Any(a => a.Id == Model.Id))
			{
				<button onclick="removeFromWatchlist(@Model.Id)" class="btn btn-danger">Remove from Watchlist</button>
			}
			else
			{
				<button onclick="addToWatchlist(@Model.Id)" class="btn btn-info">Add to Watchlist</button>
			}
		</div>
	</div>
</div>

<script
	src="https://code.jquery.com/jquery-3.7.0.min.js"
	integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g="
	crossorigin="anonymous">
</script>
<script>
	function addToWatchlist(auctionId) {
		$.ajax({
			url: '/Watchlist/Add',
			method: 'POST',
			data: { id: auctionId },
			success: function(response) {
				// Update the button text or perform any additional actions
				alert('Auction added to watchlist!');
			},
			error: function() {
				alert('Error occurred while adding auction to watchlist.');
			}
		});
	}

	function removeFromWatchlist(auctionId) {
		$.ajax({
			url: '/Watchlist/Remove',
			method: 'POST',
			data: { id: auctionId },
			success: function(response) {
				// Update the button text or perform any additional actions
				alert('Auction removed from watchlist!');
			},
			error: function() {
				alert('Error occurred while removing auction from watchlist.');
			}
		});
	}
</script>